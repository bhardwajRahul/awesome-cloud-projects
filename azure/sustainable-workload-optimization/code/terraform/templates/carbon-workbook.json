{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Carbon Optimization Dashboard\n\n**Comprehensive insights into your Azure carbon footprint and optimization opportunities**\n\n---\n\nThis workbook provides real-time visibility into carbon optimization progress, enabling data-driven decision making for sustainability initiatives. Monitor your environmental impact, track optimization opportunities, and measure the effectiveness of your carbon reduction efforts.\n\n**Key Features:**\n- Carbon emissions tracking and trends\n- Optimization recommendations analysis\n- Resource utilization patterns\n- Environmental impact metrics\n- Automated remediation status\n\n**Data Sources:**\n- Azure Carbon Optimization API\n- Azure Advisor recommendations\n- Resource utilization metrics\n- Automation account job logs\n\n---"
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "timeRange",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "description": "Select the time range for analysis",
            "value": {
              "durationMs": 2592000000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            }
          },
          {
            "id": "subscriptionId",
            "version": "KqlParameterItem/1.0",
            "name": "SubscriptionId",
            "type": 1,
            "description": "Azure subscription ID",
            "value": "${subscription_id}",
            "isHiddenWhenLocked": true
          }
        ]
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "CarbonOptimization_CL\n| where TimeGenerated {TimeRange}\n| summarize \n    TotalRecommendations = count(),\n    TotalCarbonSavings = sum(CarbonSavingsEstimate_d),\n    HighPriorityRecommendations = countif(Priority_s == \"High\"),\n    MediumPriorityRecommendations = countif(Priority_s == \"Medium\"),\n    LowPriorityRecommendations = countif(Priority_s == \"Low\")\n| extend \n    AverageCarbonSavings = TotalCarbonSavings / TotalRecommendations,\n    HighPriorityPercentage = (HighPriorityRecommendations * 100.0) / TotalRecommendations",
        "size": 3,
        "title": "Carbon Optimization Summary",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "TotalRecommendations",
            "formatter": 1,
            "formatOptions": {
              "showIcon": true
            }
          },
          "leftContent": {
            "columnMatch": "TotalRecommendations",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            }
          },
          "secondaryContent": {
            "columnMatch": "TotalCarbonSavings",
            "formatter": 1,
            "formatOptions": {
              "showIcon": true
            }
          },
          "showBorder": false
        }
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "CarbonOptimization_CL\n| where TimeGenerated {TimeRange}\n| summarize TotalCarbonSavings = sum(CarbonSavingsEstimate_d) by bin(TimeGenerated, 1d)\n| sort by TimeGenerated asc\n| render timechart with (title=\"Carbon Savings Trend (kg CO2)\", xtitle=\"Date\", ytitle=\"Carbon Savings (kg CO2)\")",
        "size": 0,
        "title": "Carbon Savings Trend",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "CarbonOptimization_CL\n| where TimeGenerated {TimeRange}\n| summarize \n    Count = count(),\n    TotalSavings = sum(CarbonSavingsEstimate_d),\n    AvgSavings = avg(CarbonSavingsEstimate_d)\nby Category_s\n| sort by TotalSavings desc\n| render piechart with (title=\"Optimization Opportunities by Category\")",
        "size": 0,
        "title": "Optimization Categories",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "CarbonOptimization_CL\n| where TimeGenerated {TimeRange}\n| summarize \n    Count = count(),\n    TotalSavings = sum(CarbonSavingsEstimate_d)\nby Priority_s\n| sort by TotalSavings desc\n| render barchart with (title=\"Recommendations by Priority Level\", xaxis=linear)",
        "size": 0,
        "title": "Priority Distribution",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "CarbonOptimization_CL\n| where TimeGenerated {TimeRange}\n| where Priority_s == \"High\"\n| project \n    TimeGenerated,\n    ResourceName_s,\n    Category_s,\n    OptimizationAction_s,\n    CarbonSavingsEstimate_d,\n    Priority_s\n| sort by CarbonSavingsEstimate_d desc\n| take 20",
        "size": 0,
        "title": "Top 20 High-Priority Recommendations",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "CarbonSavingsEstimate_d",
              "formatter": 8,
              "formatOptions": {
                "min": 0,
                "palette": "greenRed"
              }
            },
            {
              "columnMatch": "Priority_s",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "High",
                    "representation": "redBright",
                    "text": "ðŸ”´ High"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Medium",
                    "representation": "orange",
                    "text": "ðŸŸ¡ Medium"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Low",
                    "representation": "green",
                    "text": "ðŸŸ¢ Low"
                  }
                ]
              }
            }
          ]
        }
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "// Azure Automation job logs for carbon optimization\nAzureDiagnostics\n| where TimeGenerated {TimeRange}\n| where Category == \"JobLogs\"\n| where RunbookName_s contains \"Carbon\"\n| summarize \n    TotalJobs = count(),\n    SuccessfulJobs = countif(ResultType == \"Success\"),\n    FailedJobs = countif(ResultType == \"Error\")\nby bin(TimeGenerated, 1d)\n| extend SuccessRate = (SuccessfulJobs * 100.0) / TotalJobs\n| render timechart with (title=\"Automation Job Success Rate\", xtitle=\"Date\", ytitle=\"Success Rate (%)\")",
        "size": 0,
        "title": "Automation Performance",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "CarbonOptimization_CL\n| where TimeGenerated {TimeRange}\n| where isnotempty(ResourceName_s)\n| summarize \n    TotalSavings = sum(CarbonSavingsEstimate_d),\n    RecommendationCount = count()\nby ResourceName_s\n| sort by TotalSavings desc\n| take 10\n| render barchart with (title=\"Top 10 Resources by Carbon Savings Potential\", xaxis=linear)",
        "size": 0,
        "title": "Resource Impact Analysis",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "CarbonOptimization_CL\n| where TimeGenerated {TimeRange}\n| summarize \n    TotalRecommendations = count(),\n    TotalCarbonSavings = sum(CarbonSavingsEstimate_d),\n    AvgCarbonSavings = avg(CarbonSavingsEstimate_d)\nby bin(TimeGenerated, 1h)\n| extend \n    CumulativeSavings = row_cumsum(TotalCarbonSavings),\n    CumulativeRecommendations = row_cumsum(TotalRecommendations)\n| project \n    TimeGenerated,\n    TotalRecommendations,\n    TotalCarbonSavings,\n    CumulativeSavings,\n    CumulativeRecommendations\n| render timechart with (title=\"Cumulative Carbon Optimization Progress\", xtitle=\"Time\", ytitle=\"Cumulative Values\")",
        "size": 0,
        "title": "Cumulative Progress",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      }
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n## ðŸŒ± Sustainability Insights\n\n**Carbon Footprint Reduction Tips:**\n\n1. **Virtual Machine Optimization**: Rightsize VMs based on actual usage patterns to reduce energy consumption\n2. **Storage Efficiency**: Clean up unused storage accounts and optimize storage tiers\n3. **Automated Scheduling**: Implement automated start/stop schedules for non-production resources\n4. **Performance Monitoring**: Use Azure Monitor to identify and eliminate resource waste\n5. **Green Regions**: Consider migrating workloads to Azure regions with renewable energy sources\n\n**Environmental Impact Metrics:**\n- Every 1 GB of unused storage eliminated saves approximately 0.1 kg CO2 annually\n- Shutting down idle VMs can save 2-5 kg CO2 per day per VM\n- Rightsizing oversized VMs can reduce carbon emissions by 15-30%\n\n**Next Steps:**\n1. Review high-priority recommendations in the table above\n2. Implement automated remediation for low-risk optimizations\n3. Schedule regular carbon optimization reviews\n4. Set up alerts for high carbon impact resources\n5. Create sustainability KPIs and track progress monthly\n\n---"
      }
    }
  ],
  "fallbackResourceIds": [
    "${workspace_id}"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}