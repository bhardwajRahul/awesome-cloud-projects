{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Azure Governance Dashboard\n\nThis comprehensive dashboard provides real-time visibility into Azure resource governance, compliance, and security posture across your organization. Use the subscription selector below to filter data by specific subscriptions.\n\n## Key Features\n- **Resource Compliance**: Monitor resources missing required tags and policy violations\n- **Location Compliance**: Track resources deployed in non-approved regions\n- **Security Posture**: View security recommendations and assessment status\n- **Policy Insights**: Analyze policy compliance across your Azure environment\n- **Resource Distribution**: Understand resource deployment patterns\n\n---"
      },
      "name": "Dashboard Title and Description"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::all"
        ],
        "parameters": [
          {
            "id": "subscription-parameter",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "label": "Subscription(s)",
            "type": 6,
            "description": "Select one or more subscriptions to monitor",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "where type =~ 'microsoft.resources/subscriptions'\r\n| project value = subscriptionId, label = subscriptionDisplayName, selected = true",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "timerange-parameter",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "description": "Select time range for data analysis",
            "isRequired": true,
            "value": {
              "durationMs": 86400000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                }
              ],
              "allowCustom": true
            }
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "Parameters Section"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "overview-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "overview",
            "style": "link"
          },
          {
            "id": "compliance-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Compliance",
            "subTarget": "compliance",
            "style": "link"
          },
          {
            "id": "security-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Security",
            "subTarget": "security",
            "style": "link"
          },
          {
            "id": "policies-tab",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Policies",
            "subTarget": "policies",
            "style": "link"
          }
        ]
      },
      "name": "Navigation Tabs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| summarize \r\n    TotalResources = count(),\r\n    ResourceTypes = dcount(type),\r\n    Subscriptions = dcount(subscriptionId),\r\n    ResourceGroups = dcount(resourceGroup),\r\n    Locations = dcount(location)",
              "size": 4,
              "title": "Resource Summary",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "TotalResources",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "TotalResources",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 0
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalResources",
                  "formatter": 1
                },
                "showBorder": false
              }
            },
            "name": "Resource Summary Tiles"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| summarize ResourceCount = count() by Type = type\r\n| top 10 by ResourceCount desc",
              "size": 0,
              "title": "Top 10 Resource Types",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "ResourceCount",
                    "color": "blue"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "Resource Types Chart"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| summarize ResourceCount = count() by Location = location\r\n| top 10 by ResourceCount desc",
              "size": 0,
              "title": "Resources by Location",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "barchart",
              "chartSettings": {
                "xAxis": "Location",
                "yAxis": [
                  "ResourceCount"
                ],
                "seriesLabelSettings": [
                  {
                    "seriesName": "ResourceCount",
                    "color": "green"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "Location Distribution Chart"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "overview"
      },
      "name": "Overview Tab"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| where tags !has \"Environment\" or tags !has \"Owner\" or tags !has \"CostCenter\"\r\n| summarize NonCompliantResources = count() by ResourceGroup = resourceGroup, ResourceType = type\r\n| top 20 by NonCompliantResources desc",
              "size": 0,
              "title": "Resources Missing Required Tags",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "NonCompliantResources",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redBright"
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "NonCompliantResources",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "NonCompliantResources",
                  "sortOrder": 2
                }
              ]
            },
            "name": "Missing Tags Table"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| where location !in (\"eastus\", \"westus\", \"centralus\", \"eastus2\", \"westus2\")\r\n| project ResourceName = name, ResourceType = type, ResourceGroup = resourceGroup, Location = location, SubscriptionId = subscriptionId\r\n| limit 100",
              "size": 0,
              "title": "Resources in Non-Approved Locations",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Location",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "orange"
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "Location Compliance Table"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "policyresources\r\n| where type == \"microsoft.policyinsights/policystates\"\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| summarize ComplianceCount = count() by ComplianceState = tostring(properties.complianceState)\r\n| order by ComplianceCount desc",
              "size": 0,
              "title": "Policy Compliance Summary",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Compliant",
                    "color": "green"
                  },
                  {
                    "seriesName": "NonCompliant",
                    "color": "red"
                  },
                  {
                    "seriesName": "Unknown",
                    "color": "gray"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "Policy Compliance Chart"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| where tags has \"Environment\"\r\n| summarize CompliantResources = count() by Environment = tostring(tags.Environment)\r\n| order by CompliantResources desc",
              "size": 0,
              "title": "Resources by Environment Tag",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "barchart",
              "chartSettings": {
                "xAxis": "Environment",
                "yAxis": [
                  "CompliantResources"
                ],
                "seriesLabelSettings": [
                  {
                    "seriesName": "CompliantResources",
                    "color": "blue"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "Environment Tag Chart"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "compliance"
      },
      "name": "Compliance Tab"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| summarize AssessmentCount = count() by Status = tostring(properties.status.code)\r\n| order by AssessmentCount desc",
              "size": 0,
              "title": "Security Assessment Status",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Healthy",
                    "color": "green"
                  },
                  {
                    "seriesName": "Unhealthy",
                    "color": "red"
                  },
                  {
                    "seriesName": "NotApplicable",
                    "color": "gray"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "Security Status Chart"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| where properties.status.code == \"Unhealthy\"\r\n| summarize UnhealthyCount = count() by Severity = tostring(properties.metadata.severity)\r\n| order by UnhealthyCount desc",
              "size": 0,
              "title": "Security Issues by Severity",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "barchart",
              "chartSettings": {
                "xAxis": "Severity",
                "yAxis": [
                  "UnhealthyCount"
                ],
                "seriesLabelSettings": [
                  {
                    "seriesName": "High",
                    "color": "red"
                  },
                  {
                    "seriesName": "Medium",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Low",
                    "color": "yellow"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "Security Severity Chart"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| where properties.status.code == \"Unhealthy\"\r\n| project \r\n    AssessmentName = properties.displayName,\r\n    ResourceName = split(properties.resourceDetails.id, \"/\")[-1],\r\n    ResourceType = split(properties.resourceDetails.id, \"/\")[-3],\r\n    Severity = properties.metadata.severity,\r\n    Description = properties.metadata.description\r\n| top 50 by Severity desc",
              "size": 0,
              "title": "Top Security Recommendations",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Severity",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redBright"
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "Severity",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Severity",
                  "sortOrder": 2
                }
              ]
            },
            "name": "Security Recommendations Table"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "security"
      },
      "name": "Security Tab"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "policyresources\r\n| where type == \"microsoft.policyinsights/policystates\"\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| summarize PolicyViolations = count() by PolicyName = tostring(properties.policyDefinitionName)\r\n| top 20 by PolicyViolations desc",
              "size": 0,
              "title": "Top Policy Violations",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "PolicyViolations",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "red"
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "PolicyViolations",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "PolicyViolations",
                  "sortOrder": 2
                }
              ]
            },
            "name": "Policy Violations Table"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "policyresources\r\n| where type == \"microsoft.policyinsights/policystates\"\r\n| where subscriptionId in ({Subscription}) or '*' in ({Subscription})\r\n| where properties.complianceState == \"NonCompliant\"\r\n| project \r\n    PolicyName = properties.policyDefinitionName,\r\n    ResourceName = split(properties.resourceId, \"/\")[-1],\r\n    ResourceType = split(properties.resourceId, \"/\")[-3],\r\n    ResourceGroup = split(properties.resourceId, \"/\")[4],\r\n    ComplianceState = properties.complianceState,\r\n    Timestamp = properties.timestamp\r\n| top 100 by Timestamp desc",
              "size": 0,
              "title": "Recent Policy Violations",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ComplianceState",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "red"
                    }
                  },
                  {
                    "columnMatch": "Timestamp",
                    "formatter": 6
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "Timestamp",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Timestamp",
                  "sortOrder": 2
                }
              ]
            },
            "name": "Recent Violations Table"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "policies"
      },
      "name": "Policies Tab"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n## Additional Resources\n\n- [Azure Resource Graph Documentation](https://docs.microsoft.com/en-us/azure/governance/resource-graph/)\n- [Azure Policy Documentation](https://docs.microsoft.com/en-us/azure/governance/policy/)\n- [Azure Security Center Documentation](https://docs.microsoft.com/en-us/azure/security-center/)\n- [Azure Monitor Workbooks Documentation](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/workbooks-overview)\n\n*Dashboard last updated: {TimeRange:label}*"
      },
      "name": "Footer Information"
    }
  ],
  "fallbackResourceIds": [],
  "fromTemplateId": "governance-dashboard-template",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}