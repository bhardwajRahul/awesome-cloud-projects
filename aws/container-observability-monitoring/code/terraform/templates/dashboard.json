{
  "widgets": [
    {
      "type": "metric",
      "x": 0,
      "y": 0,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ContainerInsights", "pod_cpu_utilization", "ClusterName", "${eks_cluster_name}" ],
          [ ".", "pod_memory_utilization", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "EKS Pod Resource Utilization",
        "period": 300,
        "yAxis": {
          "left": {
            "min": 0,
            "max": 100
          }
        },
        "stat": "Average",
        "annotations": {
          "horizontal": [
            {
              "label": "CPU Threshold",
              "value": 80
            },
            {
              "label": "Memory Threshold", 
              "value": 80
            }
          ]
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 0,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ECS", "CPUUtilization", "ServiceName", "${ecs_service_name}", "ClusterName", "${ecs_cluster_name}" ],
          [ ".", "MemoryUtilization", ".", ".", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "ECS Service Resource Utilization",
        "period": 300,
        "stat": "Average",
        "yAxis": {
          "left": {
            "min": 0,
            "max": 100
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 6,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ContainerInsights", "pod_network_rx_bytes", "ClusterName", "${eks_cluster_name}" ],
          [ ".", "pod_network_tx_bytes", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "EKS Network I/O",
        "period": 300,
        "stat": "Average",
        "yAxis": {
          "left": {
            "min": 0
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 6,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ECS", "RunningTaskCount", "ServiceName", "${ecs_service_name}", "ClusterName", "${ecs_cluster_name}" ],
          [ ".", "PendingTaskCount", ".", ".", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "ECS Task Counts",
        "period": 300,
        "stat": "Average",
        "yAxis": {
          "left": {
            "min": 0
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 12,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ContainerInsights", "node_cpu_utilization", "ClusterName", "${eks_cluster_name}" ],
          [ ".", "node_memory_utilization", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "EKS Node Resource Utilization",
        "period": 300,
        "stat": "Average"
      }
    },
    {
      "type": "metric",
      "x": 8,
      "y": 12,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ContainerInsights", "node_number_of_running_pods", "ClusterName", "${eks_cluster_name}" ],
          [ ".", "node_number_of_running_containers", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "EKS Node Pod/Container Counts",
        "period": 300,
        "stat": "Average"
      }
    },
    {
      "type": "metric",
      "x": 16,
      "y": 12,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ContainerInsights", "pod_number_of_container_restarts", "ClusterName", "${eks_cluster_name}" ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Pod Container Restarts",
        "period": 300,
        "stat": "Sum"
      }
    },
    {
      "type": "log",
      "x": 0,
      "y": 18,
      "width": 24,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/containerinsights/${eks_cluster_name}/application' | fields @timestamp, log\n| filter @message like /ERROR/\n| sort @timestamp desc\n| limit 20",
        "region": "${region}",
        "title": "Recent Application Errors",
        "view": "table"
      }
    },
    {
      "type": "log",
      "x": 0,
      "y": 24,
      "width": 12,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/ecs/${ecs_cluster_name}/application' | fields @timestamp, @message\n| filter @message like /ERROR/ or @message like /WARN/\n| sort @timestamp desc\n| limit 20",
        "region": "${region}",
        "title": "ECS Application Logs",
        "view": "table"
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 24,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/X-Ray", "TracesReceived", { "stat": "Sum" } ],
          [ ".", "TracesProcessed", { "stat": "Sum" } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "X-Ray Traces",
        "period": 300
      }
    }
  ]
}