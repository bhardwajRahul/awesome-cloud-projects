{
  "widgets": [
    {
      "type": "metric",
      "x": 0,
      "y": 0,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/DRS", "ReplicationLag", "SourceServerID", "ALL" ],
          [ ".", "ReplicationStatus", ".", "." ],
          [ ".", "StagingStorageUtilization", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${primary_region}",
        "title": "DRS Replication Metrics",
        "period": 300,
        "stat": "Average",
        "yAxis": {
          "left": {
            "min": 0
          }
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 0,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "Custom/DRS", "ReplicationLag", { "stat": "Average" } ],
          [ ".", "ReplicationErrors", { "stat": "Sum" } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${primary_region}",
        "title": "Custom DRS Metrics",
        "period": 300,
        "yAxis": {
          "left": {
            "min": 0
          }
        }
      }
    },
    {
      "type": "log",
      "x": 0,
      "y": 6,
      "width": 24,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/lambda/dr-automated-failover-${project_id}' | fields @timestamp, @message, @requestId\n| filter @message like /ERROR/ or @message like /WARN/ or @message like /âœ…/\n| sort @timestamp desc\n| limit 100",
        "region": "${primary_region}",
        "title": "DR Automation Logs - Recent Activity",
        "view": "table"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 12,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "Duration", "FunctionName", "dr-automated-failover-${project_id}" ],
          [ ".", "Errors", ".", "." ],
          [ ".", "Invocations", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${primary_region}",
        "title": "Failover Lambda Metrics",
        "period": 300,
        "stat": "Average"
      }
    },
    {
      "type": "metric",
      "x": 8,
      "y": 12,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "Duration", "FunctionName", "dr-testing-${project_id}" ],
          [ ".", "Errors", ".", "." ],
          [ ".", "Invocations", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${primary_region}",
        "title": "Testing Lambda Metrics",
        "period": 300,
        "stat": "Average"
      }
    },
    {
      "type": "metric",
      "x": 16,
      "y": 12,
      "width": 8,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/States", "ExecutionsFailed", "StateMachineArn", "arn:aws:states:${primary_region}:*:stateMachine:dr-orchestration-${project_id}" ],
          [ ".", "ExecutionsSucceeded", ".", "." ],
          [ ".", "ExecutionsStarted", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${primary_region}",
        "title": "Step Functions Executions",
        "period": 300,
        "stat": "Sum"
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 18,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "Custom/DRS/Testing", "DrillJobsStarted" ],
          [ ".", "ServersAvailableForTesting" ],
          [ ".", "DrillSuccessRate" ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${primary_region}",
        "title": "DR Testing Metrics",
        "period": 300,
        "stat": "Average"
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 18,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "Custom/DRS/Failback", "FailbackJobsStarted" ],
          [ ".", "InstancesAvailableForFailback" ],
          [ ".", "FailbackSuccessRate" ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${primary_region}",
        "title": "DR Failback Metrics",
        "period": 300,
        "stat": "Average"
      }
    },
    {
      "type": "text",
      "x": 0,
      "y": 24,
      "width": 24,
      "height": 3,
      "properties": {
        "markdown": "## Disaster Recovery Dashboard\n\nThis dashboard provides comprehensive monitoring of your AWS Elastic Disaster Recovery automation:\n\n- **Replication Metrics**: Monitor DRS replication lag and status\n- **Lambda Functions**: Track execution metrics for failover, testing, and failback functions\n- **Step Functions**: Monitor orchestration workflow executions\n- **Custom Metrics**: View DR testing and failback success rates\n- **Logs**: Recent automation activity and error tracking\n\n### Key Alerts:\n- Replication lag > 5 minutes indicates potential issues\n- Lambda errors require immediate investigation\n- Failed Step Function executions indicate orchestration problems\n\n### Next Steps:\n1. Review any failed executions or errors\n2. Validate replication status is CONTINUOUS\n3. Test failover procedures regularly\n4. Monitor costs associated with DRS resources"
      }
    }
  ]
}